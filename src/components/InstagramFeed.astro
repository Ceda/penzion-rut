---
import { cachedFetch } from "../utils/cached-fetch";

const BEHOLD_URL = "https://feeds.behold.so/DjdBpJzYGtk9JQjmybl6";

interface InstagramPost {
  id: string;
  permalink: string;
  mediaUrl: string;
  caption?: string;
  prunedCaption?: string;
  sizes: {
    small: { mediaUrl: string };
    medium: { mediaUrl: string };
    large: { mediaUrl: string };
  };
}

let instagramPosts: InstagramPost[] = [];
let error = false;

try {
  const response = await cachedFetch(BEHOLD_URL, 86400); // 24 hours cache
  const data = (await response.json()) as { posts?: InstagramPost[] };
  instagramPosts = (data.posts || []).slice(0, 6); // Show max 6 posts
} catch (err) {
  console.error("Failed to fetch Instagram feed:", err);
  error = true;
}
---

<div class="instagram-feed">
  {
    error ? (
      <p style="color: #999; font-style: italic;">
        Instagram feed není momentálně k dispozici
      </p>
    ) : instagramPosts.length === 0 ? (
      <p style="color: #999; font-style: italic;">Načítání příspěvků...</p>
    ) : (
      <div class="instagram-grid">
        {instagramPosts.map((post) => (
          <a
            href={post.permalink}
            target="_blank"
            rel="noopener noreferrer"
            class="instagram-item"
          >
            <img
              src={post.sizes.large.mediaUrl}
              alt={post.prunedCaption || "Instagram příspěvek"}
              loading="lazy"
            />
          </a>
        ))}
      </div>
    )
  }
</div>

<style>
  .instagram-feed {
    margin: 10px 0;
  }

  .instagram-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }

  .instagram-item {
    position: relative;
    display: block;
    overflow: hidden;
    border-radius: 4px;
    transition: transform 0.2s ease;
    aspect-ratio: 1;
  }

  .instagram-item:hover {
    transform: scale(1.05);
  }

  .instagram-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  @media (max-width: 768px) {
    .instagram-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>
